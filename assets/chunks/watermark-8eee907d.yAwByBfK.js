import{r as $e,P as we}from"./index.ghQPKumy.js";import{d as te,h as T,al as ze,g as ne,j as oe,D as K,aH as _e,o as ae,b as Se,w as g,I as y,k as D,t as Ae,m as L,av as Ie,aD as De,aj as Ee,y as Pe,af as Ce,c as Me,r as Ne,O as Re,P as je}from"./framework.e2dboEyh.js";import"../app.kf9R8BQv.js";import"./theme.2Uqr2FmO.js";const B=2,Q=3,I=new WeakMap;function re(r,o){let t=null;return{render:a,destroy:s};function a(){const l=d();if(!l)return;const{zIndex:k=1e3,rotate:h=-22,width:$,height:c,image:E,content:u,font:le,gap:ie=[100,100],offset:w=[0]}=(o==null?void 0:o.value)||{},{color:se="rgba(0, 0, 0, 0.15)",fontSize:P=14,fontWeight:ce="normal",fontStyle:ue="normal",fontFamily:O="sans-serif"}=le||{},[b,z]=ie,V=b/2,W=z/2,fe=(w==null?void 0:w[0])??V,de=(w==null?void 0:w[1])??W,_=document.createElement("canvas"),v=_.getContext("2d");if(!v)return;if(I.has(l)){const e=I.get(l);e&&(t=e)}else t=document.createElement("div");const f=J(),[C,U]=ye(v),M=(b+C)*f,N=(z+U)*f;_.setAttribute("width",`${M*B}px`),_.setAttribute("height",`${N*B}px`);const Z=b*f/2,F=z*f/2,H=C*f,X=U*f,Y=(H+b*f)/2,q=(X+z*f)/2,pe=Z+M,me=F+N,he=Y+M,xe=q+N;v.save(),ee(v,Y,q,h),ge(_,v,Z,F,H,X,he,xe,pe,me,C),t&&I.set(l,t);function ge(e,n,i,p,x,m,S,A,R,j,ke){G(n,i,p,x,m),n.restore(),ee(n,S,A,h),G(n,R,j,x,m),ve(e.toDataURL(),ke)}function G(e,n,i,p,x){const m=J(),S=Number(P)*m;e.font=`${ue} normal ${ce} ${S}px/${x}px ${O}`,e.fillStyle=se,e.textAlign="center",e.textBaseline="top",e.translate(p/2,0);const A=Array.isArray(u)?u:[u];A==null||A.forEach((R,j)=>{e.fillText(R??"",n,i+j*(S+Q*m))})}function ye(e){let n=120,i=64;if(!E&&e.measureText){e.font=`${Number(P)}px ${O}`;const p=Array.isArray(u)?u:[u],x=p.map(m=>e.measureText(m||"").width);n=Math.ceil(Math.max(...x)),i=Number(P)*p.length+(p.length-1)*Q}return[$??n,c??i]}function be(){const e={zIndex:k,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let n=fe-V,i=de-W;return n>0&&(e.left=`${n}px`,e.width=`calc(100% - ${n}px)`,n=0),i>0&&(e.top=`${i}px`,e.height=`calc(100% - ${i}px)`,i=0),e.backgroundPosition=`${n}px ${i}px`,e}function ve(e,n){t&&t.setAttribute("style",Be({...be(),backgroundImage:`url('${e}')`,backgroundSize:`${(b+n)*B}px`})),t&&l&&l.append(t)}}function s(){if(t){t.remove(),t=null;const l=d();l&&I.delete(l)}}function d(){return L(r)}}function J(){return window.devicePixelRatio||1}function ee(r,o,t,a){r.translate(o,t),r.rotate(Math.PI/180*Number(a)),r.translate(-o,-t)}function Be(r){return Object.keys(r).map(o=>`${Te(o)}: ${r[o]};`).join(" ")}function Te(r){return r.replace(/([A-Z])/g,"-$1").toLowerCase()}const Le=te({__name:"watermark",props:{zIndex:{},rotate:{},width:{},height:{},image:{},content:{},font:{},style:{},gap:{},offset:{}},setup(r){const o=T(null),t=r,{render:a,destroy:s}=re(o,T(t));oe(()=>{o.value&&a()}),Pe(()=>t,()=>{s(),a()},{deep:!0}),Ce(()=>{s()});const d=ne(()=>({position:"relative"}));return(l,k)=>(ae(),Me("div",{ref_key:"watermarkContainerRef",ref:o,class:"watermark",style:Re(d.value)},[Ne(l.$slots,"default")],4))}}),Oe=$e(Le),Ve=D("div",{style:{height:"200px"}},null,-1),We={style:{position:"relative",height:"200px"}},Xe=te({__name:"watermark",setup(r){const o=[{label:"水印文字",key:"content",el:"el-input"},{label:"字体颜色",key:"color",el:"el-color-picker"},{label:"字体大小",key:"fontSize",el:"el-slider"},{label:"z-index",key:"zIndex",el:"el-slider"},{label:"旋转角度",key:"rotate",el:"el-slider",attrs:{min:-180,max:180}}],t=T(null),a=ze({content:"测试水印",fontSize:14,color:"rgba(0, 0, 0, 0.15)",zIndex:0,rotate:-22}),s=ne(()=>({content:a.content,font:{fontSize:a.fontSize,color:a.color},zIndex:a.zIndex,rotate:a.rotate})),{render:d,destroy:l}=re(t,s);oe(()=>{d()});const k=h=>{Object.keys(h).forEach($=>{const c=$;a[c]=h[c]}),l(),je(()=>{d()})};return(h,$)=>{const c=K("page-card"),E=K("page-wrapper"),u=_e("watermark");return ae(),Se(E,null,{default:g(()=>[y(c,{style:{"margin-bottom":"20px"},full:!1,header:"自定义配置"},{default:g(()=>[D("pre",null,"          "+Ae(s.value)+`
      `,1),y(L(we),{fields:o,model:a,"label-position":"top","enable-effect":"",onEffect:k},null,8,["model"])]),_:1}),y(c,{style:{"margin-bottom":"20px"},full:!1,header:"组件水印"},{default:g(()=>[y(L(Oe),Ie(De(s.value)),{default:g(()=>[Ve]),_:1},16)]),_:1}),y(c,{style:{"margin-bottom":"20px"},full:!1,header:"hook 水印"},{default:g(()=>[D("div",{ref_key:"hookWaterRef",ref:t,style:{position:"relative",height:"200px"}},null,512)]),_:1}),y(c,{style:{"margin-bottom":"20px"},full:!1,header:"vue 指令 水印"},{default:g(()=>[Ee(D("div",We,null,512),[[u,s.value]])]),_:1})]),_:1})}}});export{Xe as default};
