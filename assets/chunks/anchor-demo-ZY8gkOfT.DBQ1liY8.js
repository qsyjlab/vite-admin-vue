import{d as W,j as G}from"./index.OAlBif3f.js";import{d as D,h as b,an as J,l as Y,y as H,U as O,ag as P,o as k,c as C,m as p,F as q,G as F,b as I,n as M,E as $,w as R,J as T,p as K,t as N,q as Q,s as Z}from"./framework.D1HSi6sf.js";import"./theme.BC9Oi9St.js";function z(e){return e!=null&&e===e.window}function U(e,c){var s;if(typeof window>"u")return 0;const t=c?"scrollTop":"scrollLeft";let a=0;return z(e)?a=e[c?"pageYOffset":"pageXOffset"]:e instanceof Document?a=e.documentElement[t]:(e instanceof HTMLElement||e)&&(a=e[t]),e&&!z(e)&&typeof a!="number"&&(a=(s=(e.ownerDocument??e).documentElement)==null?void 0:s[t]),a}function ee(e,c,s,t){const a=s-c;return e/=t/2,e<1?a/2*e*e*e+c:a/2*((e-=2)*e*e+2)+c}function ne(e,c={}){const{getContainer:s=()=>window,callback:t,duration:a=450}=c,i=s(),r=U(i,!0),m=Date.now(),h=()=>{const v=Date.now()-m,d=ee(v>a?a:v,r,e,a);z(i)?i.scrollTo(window.scrollX,d):i instanceof Document||i.constructor.name==="HTMLDocument"?i.documentElement.scrollTop=d:i.scrollTop=d,v<a?requestAnimationFrame(h):typeof t=="function"&&requestAnimationFrame(t)};requestAnimationFrame(h)}const te={class:"anchor__children"},X=D({__name:"anchor-link",props:{anchor:{},activeKey:{}},emits:["click"],setup(e,{emit:c}){const s=c,t=(a,i)=>{s("click",a,i)};return(a,i)=>(k(),C("div",{class:"anchor__link",onClick:i[0]||(i[0]=r=>t(r,a.anchor))},[p("div",{class:M(["anchor__title",a.activeKey===a.anchor.link?"active":""])},N(a.anchor.title),3),p("div",te,[(k(!0),C(q,null,F(a.anchor.children,r=>(k(),I(X,{key:r.link,anchor:r,"active-key":a.activeKey,onClick:m=>t(m,r)},null,8,["anchor","active-key","onClick"]))),128))])]))}}),ae=D({__name:"anchor",props:{modelValue:{},container:{type:[String,Function],default:()=>window},anchors:{default:()=>[]},targetOffset:{},offsetTop:{},direction:{default:"vertical"},bounds:{default:5}},emits:["update:model-value","change"],setup(e,{emit:c}){const s=c,t=e,a=b(null),i=b(null),r=J({active:"",animating:!1,links:[]});Y(()=>{x(B());const n=w();d(),n==null||n.addEventListener("scroll",d),H([()=>t],()=>{x(B());const o=w();d(),o==null||o.addEventListener("scroll",d)},{deep:!0,flush:"post"}),H(()=>t.modelValue,(o,l)=>{console.log("modelValue",t.modelValue),!(o===l||r.active===o)&&O(()=>{t.modelValue&&m(t.modelValue)})},{immediate:!0})}),P(()=>{const n=w();n==null||n.removeEventListener("scroll",d)});const m=n=>{h(n),v(n)};function h(n){r.animating||r.active===n||(r.active=n,O(()=>{var o;const l=(o=a.value)==null?void 0:o.querySelector(".anchor__title.active");if(!l||!i.value)return;const g=l==null?void 0:l.offsetTop,f=l.clientHeight,u=i.value.style;t.direction==="horizontal"?(u.left=`${l.offsetLeft}px`,u.width=`${l.clientWidth}px`):(u.top=`${g+f/2}px`,u.height=`${f}px`),j()}))}function v(n){if(r.animating)return;const o=document.getElementById(n);if(!o)return;const l=w();if(!l)return;const g=U(l,!0),f=y(o,l);let u=g+f;u-=S(),r.animating=!0,l&&ne(u,{getContainer:()=>l,callback(){r.animating=!1}})}function d(){if(r.animating)return;const n=V(r.links,S(),t.bounds);n&&h(n)}const V=(n,o=0,l=5)=>{const g=[],f=w();return n.forEach(u=>{const _=document.getElementById(u);if(_&&f){const A=y(_,f);A<o+l&&g.push({link:u,top:A})}}),g.length?g.reduce((u,_)=>_.top>u.top?_:u).link:""};function y(n,o){if(!n.getClientRects().length)return 0;const l=n.getBoundingClientRect();return l.width||l.height?o===window?(o=document.documentElement,l.top-o.clientTop):l.top-o.getBoundingClientRect().top:l.top}function w(){let n=null;return typeof t.container=="string"?n=document.querySelector(t.container):n=t.container(),n||window}function x(n){n.forEach(o=>{r.links.push(o.link),o.children&&x(o.children)})}function B(){return t.direction==="horizontal"?t.anchors.map(n=>({...n,children:void 0})):t.anchors}function S(){const{targetOffset:n,offsetTop:o}=t;return n!==void 0?n:o||0}function j(){s("change",r.active),s("update:model-value",r.active)}return(n,o)=>(k(),C("div",{ref_key:"anchorRef",ref:a,class:M(["anchor",n.direction==="horizontal"?"is-horizontal":""])},[p("span",{ref_key:"indicatorRef",ref:i,class:"anchor-indicator"},null,512),(k(!0),C(q,null,F(B(),l=>(k(),I(X,{key:l.link,anchor:l,"active-key":r.active,onClick:o[0]||(o[0]=(g,f)=>m(f.link))},null,8,["anchor","active-key"]))),128))],2))}}),L=W(ae),E=e=>(Q("data-v-aa0ab75f"),e=e(),Z(),e),oe=E(()=>p("div",{id:"part-1",class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}}," part-1 ",-1)),le=E(()=>p("div",{id:"part-4",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-4 ",-1)),re=E(()=>p("div",{id:"part-5",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-5 ",-1)),ie=E(()=>p("div",{id:"part-2",class:"ac-container",style:{"background-color":"rgba(0, 255, 0, 0.02)"}}," part-2 ",-1)),ce=E(()=>p("div",{id:"part-3",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-3 ",-1)),se=[oe,le,re,ie,ce],ue=["id"],de=D({__name:"anchor-demo",setup(e){const c=b(),s=b(),t=b("part-4"),a=b(40);setTimeout(()=>{t.value="part-3",a.value=30},1e3);const i=[{title:"part-1",link:"part-1",children:[{title:"part-4",link:"part-4"},{title:"part-5",link:"part-5"}]},{title:"part-2",link:"part-2"},{title:"part-3",link:"part-3"}],r=[{title:"part-11",link:"part-11",children:[{title:"part-12",link:"part-12"},{title:"part-13",link:"part-13"}]},{title:"part-21",link:"part-21"},{title:"part-31",link:"part-32"}],m=h=>{console.log("link anchorChangeHandler",h)};return console.log("Anchor",L),(h,v)=>{const d=$("page-card"),V=$("page-wrapper");return k(),I(V,null,{default:R(()=>[T(d,{header:"锚点",full:!1,style:{"margin-bottom":"20px"}},{default:R(()=>[T(K(L),{modelValue:t.value,"onUpdate:modelValue":v[0]||(v[0]=y=>t.value=y),container:()=>c.value,anchors:i,bounds:a.value,onChange:m},null,8,["modelValue","container","bounds"]),p("div",{ref_key:"containerRef",ref:c,style:{height:"500px",overflow:"auto"}},se,512)]),_:1}),T(d,{full:!1,header:"horizontal 模式<"},{default:R(()=>[T(K(L),{container:()=>s.value,anchors:r,direction:"horizontal"},null,8,["container"]),p("div",{ref_key:"container2Ref",ref:s,style:{height:"500px",overflow:"auto"}},[(k(),C(q,null,F(r,(y,w)=>p("div",{id:y.link,key:w,class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}},N(y.title),9,ue)),64))],512)]),_:1})]),_:1})}}}),he=G(de,[["__scopeId","data-v-aa0ab75f"]]);export{he as default};
