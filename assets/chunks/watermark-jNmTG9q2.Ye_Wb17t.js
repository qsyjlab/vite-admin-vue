import{ab as $e,z as te,x as L,ac as we,B as ne,y as ae,A as Q,T as ze,a as oe,n as Ae,b as g,W as b,q as E,s as _e,K as X,ap as Ie,c as Se,l as Ee,_ as Te,X as je,ak as Re,m as We,F as Ce,r as Me,ae as Ne}from"./index.CXx_r3g5.js";import"./framework.CtQlGyLl.js";import"./theme.lKphzJcC.js";const F=2,V=3,S=new WeakMap;function le(l,a){let t=null;return{render:o,destroy:s};function o(){const r=d();if(!r)return;const{zIndex:v=1e3,rotate:h=-22,width:$,height:u,image:T,content:c,font:re,gap:ie=[100,100],offset:w=[0]}=(a==null?void 0:a.value)||{},{color:se="rgba(0, 0, 0, 0.15)",fontSize:j=14,fontWeight:ue="normal",fontStyle:ce="normal",fontFamily:q="sans-serif"}=re||{},[y,z]=ie,B=y/2,D=z/2,fe=(w==null?void 0:w[0])??B,de=(w==null?void 0:w[1])??D,A=document.createElement("canvas"),k=A.getContext("2d");if(!k)return;if(S.has(r)){const e=S.get(r);e&&(t=e)}else t=document.createElement("div");const f=J(),[R,K]=be(k),W=(y+R)*f,C=(z+K)*f;A.setAttribute("width",`${W*F}px`),A.setAttribute("height",`${C*F}px`);const O=y*f/2,P=z*f/2,Y=R*f,Z=K*f,H=(Y+y*f)/2,U=(Z+z*f)/2,pe=O+W,me=P+C,he=H+W,xe=U+C;k.save(),ee(k,H,U,h),ge(A,k,O,P,Y,Z,he,xe,pe,me,R),t&&S.set(r,t);function ge(e,n,i,p,x,m,_,I,M,N,ve){G(n,i,p,x,m),n.restore(),ee(n,_,I,h),G(n,M,N,x,m),ke(e.toDataURL(),ve)}function G(e,n,i,p,x){const m=J(),_=Number(j)*m;e.font=`${ce} normal ${ue} ${_}px/${x}px ${q}`,e.fillStyle=se,e.textAlign="center",e.textBaseline="top",e.translate(p/2,0);const I=Array.isArray(c)?c:[c];I==null||I.forEach((M,N)=>{e.fillText(M??"",n,i+N*(_+V*m))})}function be(e){let n=120,i=64;if(!T&&e.measureText){e.font=`${Number(j)}px ${q}`;const p=Array.isArray(c)?c:[c],x=p.map(m=>e.measureText(m||"").width);n=Math.ceil(Math.max(...x)),i=Number(j)*p.length+(p.length-1)*V}return[$??n,u??i]}function ye(){const e={zIndex:v,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let n=fe-B,i=de-D;return n>0&&(e.left=`${n}px`,e.width=`calc(100% - ${n}px)`,n=0),i>0&&(e.top=`${i}px`,e.height=`calc(100% - ${i}px)`,i=0),e.backgroundPosition=`${n}px ${i}px`,e}function ke(e,n){t&&t.setAttribute("style",Fe({...ye(),backgroundImage:`url('${e}')`,backgroundSize:`${(y+n)*F}px`})),t&&r&&r.append(t)}}function s(){if(t){t.remove(),t=null;const r=d();r&&S.delete(r)}}function d(){return X(l)}}function J(){return window.devicePixelRatio||1}function ee(l,a,t,o){l.translate(a,t),l.rotate(Math.PI/180*Number(o)),l.translate(-a,-t)}function Fe(l){return Object.keys(l).map(a=>`${Le(a)}: ${l[a]};`).join(" ")}function Le(l){return l.replace(/([A-Z])/g,"-$1").toLowerCase()}const Xe=te({__name:"watermark",props:{zIndex:{},rotate:{},width:{},height:{},image:{},content:{},font:{},style:{},gap:{},offset:{}},setup(l){const a=L(null),t=l,{render:o,destroy:s}=le(a,L(t));ae(()=>{a.value&&o()}),je(()=>t,()=>{s(),o()},{deep:!0}),Re(()=>{s()});const d=ne(()=>({position:"relative"}));return(r,v)=>(oe(),We("div",{ref_key:"watermarkContainerRef",ref:a,class:"watermark",style:Me(d.value)},[Ce(r.$slots,"default")],4))}}),qe=$e(Xe),Be=E("div",{style:{height:"200px"}},null,-1),De={style:{position:"relative",height:"200px"}},Ye=te({__name:"watermark",setup(l){const a=[{label:"水印文字",key:"content",el:"el-input"},{label:"字体颜色",key:"color",el:"el-color-picker"},{label:"字体大小",key:"fontSize",el:"el-slider"},{label:"z-index",key:"zIndex",el:"el-slider"},{label:"旋转角度",key:"rotate",el:"el-slider",attrs:{min:-180,max:180}}],t=L(null),o=we({content:"测试水印",fontSize:14,color:"rgba(0, 0, 0, 0.15)",zIndex:0,rotate:-22}),s=ne(()=>({content:o.content,font:{fontSize:o.fontSize,color:o.color},zIndex:o.zIndex,rotate:o.rotate})),{render:d,destroy:r}=le(t,s);ae(()=>{d()});const v=h=>{Object.keys(h).forEach($=>{const u=$;o[u]=h[u]}),r(),Ne(()=>{d()})};return(h,$)=>{const u=Q("page-card"),T=Q("page-wrapper"),c=ze("watermark");return oe(),Ae(T,null,{default:g(()=>[b(u,{style:{"margin-bottom":"20px"},full:!1,header:"自定义配置"},{default:g(()=>[E("pre",null,"          "+_e(s.value)+`
      `,1),b(X(Ie),{fields:a,model:o,"label-position":"top","enable-effect":"",onEffect:v},null,8,["model"])]),_:1}),b(u,{style:{"margin-bottom":"20px"},full:!1,header:"组件水印"},{default:g(()=>[b(X(qe),Se(Ee(s.value)),{default:g(()=>[Be]),_:1},16)]),_:1}),b(u,{style:{"margin-bottom":"20px"},full:!1,header:"hook 水印"},{default:g(()=>[E("div",{ref_key:"hookWaterRef",ref:t,style:{position:"relative",height:"200px"}},null,512)]),_:1}),b(u,{style:{"margin-bottom":"20px"},full:!1,header:"vue 指令 水印"},{default:g(()=>[Te(E("div",De,null,512),[[c,s.value]])]),_:1})]),_:1})}}});export{Ye as default};
