import{e as $e,x as we}from"./index.B_-AZqtN.js";import{d as te,h as j,an as ze,k as ne,l as oe,E as G,aK as _e,o as ae,b as Se,w as y,J as k,m as I,t as Ae,p as L,ay as Ie,az as Ee,ak as Ce,y as Ne,ah as Re,c as Be,r as De,Q as Me,U as Pe}from"./framework.D1sHVKzl.js";import"./theme.af-yJUCQ.js";const T=2,J=3,E=new WeakMap;function re(r,o){let t=null;return{render:a,destroy:s};function a(){const l=d();if(!l)return;const{zIndex:$=1e3,rotate:h=-22,width:x,height:c,image:C,content:u,font:le,gap:ie=[100,100],offset:w=[0]}=(o==null?void 0:o.value)||{},{color:se="rgba(0, 0, 0, 0.15)",fontSize:N=14,fontWeight:ce="normal",fontStyle:ue="normal",fontFamily:U="sans-serif"}=le||{},[v,z]=ie,W=v/2,O=z/2,fe=(w==null?void 0:w[0])??W,de=(w==null?void 0:w[1])??O,_=document.createElement("canvas"),b=_.getContext("2d");if(!b)return;if(E.has(l)){const e=E.get(l);e&&(t=e)}else t=document.createElement("div");const f=Y(),[R,V]=ye(b),B=(v+R)*f,D=(z+V)*f;_.setAttribute("width",`${B*T}px`),_.setAttribute("height",`${D*T}px`);const F=v*f/2,H=z*f/2,K=R*f,Q=V*f,X=(K+v*f)/2,Z=(Q+z*f)/2,pe=F+B,me=H+D,he=X+B,xe=Z+D;b.save(),ee(b,X,Z,h),ge(_,b,F,H,K,Q,he,xe,pe,me,R),t&&E.set(l,t);function ge(e,n,i,p,g,m,S,A,M,P,be){q(n,i,p,g,m),n.restore(),ee(n,S,A,h),q(n,M,P,g,m),ve(e.toDataURL(),be)}function q(e,n,i,p,g){const m=Y(),S=Number(N)*m;e.font=`${ue} normal ${ce} ${S}px/${g}px ${U}`,e.fillStyle=se,e.textAlign="center",e.textBaseline="top",e.translate(p/2,0);const A=Array.isArray(u)?u:[u];A==null||A.forEach((M,P)=>{e.fillText(M??"",n,i+P*(S+J*m))})}function ye(e){let n=120,i=64;if(!C&&e.measureText){e.font=`${Number(N)}px ${U}`;const p=Array.isArray(u)?u:[u],g=p.map(m=>e.measureText(m||"").width);n=Math.ceil(Math.max(...g)),i=Number(N)*p.length+(p.length-1)*J}return[x??n,c??i]}function ke(){const e={zIndex:$,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let n=fe-W,i=de-O;return n>0&&(e.left=`${n}px`,e.width=`calc(100% - ${n}px)`,n=0),i>0&&(e.top=`${i}px`,e.height=`calc(100% - ${i}px)`,i=0),e.backgroundPosition=`${n}px ${i}px`,e}function ve(e,n){t&&t.setAttribute("style",Te({...ke(),backgroundImage:`url('${e}')`,backgroundSize:`${(v+n)*T}px`})),t&&l&&l.append(t)}}function s(){if(t){t.remove(),t=null;const l=d();l&&E.delete(l)}}function d(){return L(r)}}function Y(){return window.devicePixelRatio||1}function ee(r,o,t,a){r.translate(o,t),r.rotate(Math.PI/180*Number(a)),r.translate(-o,-t)}function Te(r){return Object.keys(r).map(o=>`${je(o)}: ${r[o]};`).join(" ")}function je(r){return r.replace(/([A-Z])/g,"-$1").toLowerCase()}const Le=te({__name:"watermark",props:{zIndex:{},rotate:{},width:{},height:{},image:{},content:{},font:{},style:{},gap:{},offset:{}},setup(r){const o=j(null),t=r,{render:a,destroy:s}=re(o,j(t));oe(()=>{o.value&&a()}),Ne(()=>t,()=>{s(),a()},{deep:!0}),Re(()=>{s()});const d=ne(()=>({position:"relative"}));return(l,$)=>(ae(),Be("div",{ref_key:"watermarkContainerRef",ref:o,class:"watermark",style:Me(d.value)},[De(l.$slots,"default")],4))}}),Ue=$e(Le),We={style:{position:"relative",height:"200px"}},He=te({__name:"watermark",setup(r){const o=[{label:"水印文字",key:"content",el:"el-input"},{label:"字体颜色",key:"color",el:"el-color-picker"},{label:"字体大小",key:"fontSize",el:"el-slider"},{label:"z-index",key:"zIndex",el:"el-slider"},{label:"旋转角度",key:"rotate",el:"el-slider",attrs:{min:-180,max:180}}],t=j(null),a=ze({content:"测试水印",fontSize:14,color:"rgba(0, 0, 0, 0.15)",zIndex:0,rotate:-22}),s=ne(()=>({content:a.content,font:{fontSize:a.fontSize,color:a.color},zIndex:a.zIndex,rotate:a.rotate})),{render:d,destroy:l}=re(t,s);oe(()=>{d()});const $=h=>{Object.keys(h).forEach(x=>{const c=x;a[c]=h[c]}),l(),Pe(()=>{d()})};return(h,x)=>{const c=G("page-card"),C=G("page-wrapper"),u=_e("watermark");return ae(),Se(C,null,{default:y(()=>[k(c,{style:{"margin-bottom":"20px"},full:!1,header:"自定义配置"},{default:y(()=>[I("pre",null,"          "+Ae(s.value)+`
      `,1),k(L(we),{fields:o,model:a,"label-position":"top","enable-effect":"",onEffect:$},null,8,["model"])]),_:1}),k(c,{style:{"margin-bottom":"20px"},full:!1,header:"组件水印"},{default:y(()=>[k(L(Ue),Ie(Ee(s.value)),{default:y(()=>x[0]||(x[0]=[I("div",{style:{height:"200px"}},null,-1)])),_:1},16)]),_:1}),k(c,{style:{"margin-bottom":"20px"},full:!1,header:"hook 水印"},{default:y(()=>[I("div",{ref_key:"hookWaterRef",ref:t,style:{position:"relative",height:"200px"}},null,512)]),_:1}),k(c,{style:{"margin-bottom":"20px"},full:!1,header:"vue 指令 水印"},{default:y(()=>[Ce(I("div",We,null,512),[[u,s.value]])]),_:1})]),_:1})}}});export{He as default};
