import{ab as U,u as G,z as q,x as _,ac as J,y as N,X as B,ae as F,ak as P,a as g,m as E,q as p,Y as D,S as X,n as $,a2 as W,A as H,b as z,W as C,K as O,s as Y,$ as Q,a0 as Z}from"./index.CXx_r3g5.js";import"./framework.CtQlGyLl.js";import"./theme.lKphzJcC.js";function R(e){return e!=null&&e===e.window}function I(e,c){var s;if(typeof window>"u")return 0;const t=c?"scrollTop":"scrollLeft";let a=0;return R(e)?a=e[c?"pageYOffset":"pageXOffset"]:e instanceof Document?a=e.documentElement[t]:(e instanceof HTMLElement||e)&&(a=e[t]),e&&!R(e)&&typeof a!="number"&&(a=(s=(e.ownerDocument??e).documentElement)==null?void 0:s[t]),a}function ee(e,c,s,t){const a=s-c;return e/=t/2,e<1?a/2*e*e*e+c:a/2*((e-=2)*e*e+2)+c}function ne(e,c={}){const{getContainer:s=()=>window,callback:t,duration:a=450}=c,r=s(),i=I(r,!0),m=Date.now(),h=()=>{const v=Date.now()-m,d=ee(v>a?a:v,i,e,a);R(r)?r.scrollTo(window.scrollX,d):r instanceof Document||r.constructor.name==="HTMLDocument"?r.documentElement.scrollTop=d:r.scrollTop=d,v<a?requestAnimationFrame(h):typeof t=="function"&&requestAnimationFrame(t)};requestAnimationFrame(h)}const te={class:"anchor__children"},j=q({__name:"anchor-link",props:{anchor:{},activeKey:{}},emits:["click"],setup(e,{emit:c}){const s=c,t=(a,r)=>{s("click",a,r)};return(a,r)=>(g(),E("div",{class:"anchor__link",onClick:r[0]||(r[0]=i=>t(i,a.anchor))},[p("div",{class:W(["anchor__title",a.activeKey===a.anchor.link?"active":""])},Y(a.anchor.title),3),p("div",te,[(g(!0),E(D,null,X(a.anchor.children,i=>(g(),$(j,{key:i.link,anchor:i,"active-key":a.activeKey,onClick:m=>t(m,i)},null,8,["anchor","active-key","onClick"]))),128))])]))}}),ae=q({__name:"anchor",props:{modelValue:{},container:{type:[String,Function],default:()=>window},anchors:{default:()=>[]},targetOffset:{},offsetTop:{},direction:{default:"vertical"},bounds:{default:5}},emits:["update:model-value","change"],setup(e,{emit:c}){const s=c,t=e,a=_(null),r=_(null),i=J({active:"",animating:!1,links:[]});N(()=>{V(A());const n=b();d(),n==null||n.addEventListener("scroll",d),B([()=>t],()=>{V(A());const o=b();d(),o==null||o.addEventListener("scroll",d)},{deep:!0,flush:"post"}),B(()=>t.modelValue,(o,l)=>{console.log("modelValue",t.modelValue),!(o===l||i.active===o)&&F(()=>{t.modelValue&&m(t.modelValue)})},{immediate:!0})}),P(()=>{const n=b();n==null||n.removeEventListener("scroll",d)});const m=n=>{h(n),v(n)};function h(n){i.animating||i.active===n||(i.active=n,F(()=>{var o;const l=(o=a.value)==null?void 0:o.querySelector(".anchor__title.active");if(!l||!r.value)return;const k=l==null?void 0:l.offsetTop,f=l.clientHeight,u=r.value.style;t.direction==="horizontal"?(u.left=`${l.offsetLeft}px`,u.width=`${l.clientWidth}px`):(u.top=`${k+f/2}px`,u.height=`${f}px`),M()}))}function v(n){if(i.animating)return;const o=document.getElementById(n);if(!o)return;const l=b();if(!l)return;const k=I(l,!0),f=y(o,l);let u=k+f;u-=K(),i.animating=!0,l&&ne(u,{getContainer:()=>l,callback(){i.animating=!1}})}function d(){if(i.animating)return;const n=T(i.links,K(),t.bounds);n&&h(n)}const T=(n,o=0,l=5)=>{const k=[],f=b();return n.forEach(u=>{const w=document.getElementById(u);if(w&&f){const S=y(w,f);S<o+l&&k.push({link:u,top:S})}}),k.length?k.reduce((u,w)=>w.top>u.top?w:u).link:""};function y(n,o){if(!n.getClientRects().length)return 0;const l=n.getBoundingClientRect();return l.width||l.height?o===window?(o=document.documentElement,l.top-o.clientTop):l.top-o.getBoundingClientRect().top:l.top}function b(){let n=null;return typeof t.container=="string"?n=document.querySelector(t.container):n=t.container(),n||window}function V(n){n.forEach(o=>{i.links.push(o.link),o.children&&V(o.children)})}function A(){return t.direction==="horizontal"?t.anchors.map(n=>({...n,children:void 0})):t.anchors}function K(){const{targetOffset:n,offsetTop:o}=t;return n!==void 0?n:o||0}function M(){s("change",i.active),s("update:model-value",i.active)}return(n,o)=>(g(),E("div",{ref_key:"anchorRef",ref:a,class:W(["anchor",n.direction==="horizontal"?"is-horizontal":""])},[p("span",{ref_key:"indicatorRef",ref:r,class:"anchor-indicator"},null,512),(g(!0),E(D,null,X(A(),l=>(g(),$(j,{key:l.link,anchor:l,"active-key":i.active,onClick:o[0]||(o[0]=(k,f)=>m(f.link))},null,8,["anchor","active-key"]))),128))],2))}}),L=U(ae),x=e=>(Q("data-v-aa0ab75f"),e=e(),Z(),e),oe=x(()=>p("div",{id:"part-1",class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}}," part-1 ",-1)),le=x(()=>p("div",{id:"part-4",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-4 ",-1)),ie=x(()=>p("div",{id:"part-5",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-5 ",-1)),re=x(()=>p("div",{id:"part-2",class:"ac-container",style:{"background-color":"rgba(0, 255, 0, 0.02)"}}," part-2 ",-1)),ce=x(()=>p("div",{id:"part-3",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-3 ",-1)),se=[oe,le,ie,re,ce],ue=["id"],de=q({__name:"anchor-demo",setup(e){const c=_(),s=_(),t=_("part-4"),a=_(40);setTimeout(()=>{t.value="part-3",a.value=30},1e3);const r=[{title:"part-1",link:"part-1",children:[{title:"part-4",link:"part-4"},{title:"part-5",link:"part-5"}]},{title:"part-2",link:"part-2"},{title:"part-3",link:"part-3"}],i=[{title:"part-11",link:"part-11",children:[{title:"part-12",link:"part-12"},{title:"part-13",link:"part-13"}]},{title:"part-21",link:"part-21"},{title:"part-31",link:"part-32"}],m=h=>{console.log("link anchorChangeHandler",h)};return console.log("Anchor",L),(h,v)=>{const d=H("page-card"),T=H("page-wrapper");return g(),$(T,null,{default:z(()=>[C(d,{header:"锚点",full:!1,style:{"margin-bottom":"20px"}},{default:z(()=>[C(O(L),{modelValue:t.value,"onUpdate:modelValue":v[0]||(v[0]=y=>t.value=y),container:()=>c.value,anchors:r,bounds:a.value,onChange:m},null,8,["modelValue","container","bounds"]),p("div",{ref_key:"containerRef",ref:c,style:{height:"500px",overflow:"auto"}},se,512)]),_:1}),C(d,{full:!1,header:"horizontal 模式<"},{default:z(()=>[C(O(L),{container:()=>s.value,anchors:i,direction:"horizontal"},null,8,["container"]),p("div",{ref_key:"container2Ref",ref:s,style:{height:"500px",overflow:"auto"}},[(g(),E(D,null,X(i,(y,b)=>p("div",{id:y.link,key:b,class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}},Y(y.title),9,ue)),64))],512)]),_:1})]),_:1})}}}),he=G(de,[["__scopeId","data-v-aa0ab75f"]]);export{he as default};
