import{u as N,n as W}from"./index.V9EroKAY.js";import{d as z,h as _,al as P,j as Y,y as A,P as H,af as G,o as k,c as C,k as d,F as R,E as q,b as F,n as K,D as O,w as B,m as $,I as V,t as M,p as J,q as Q}from"./framework.SCZo_iHs.js";import"../app.g2pGqmxW.js";import"./theme.Lm0SghTC.js";function D(e){return e!=null&&e===e.window}function U(e,c){var o;if(typeof window>"u")return 0;const i=c?"scrollTop":"scrollLeft";let r=0;return D(e)?r=e[c?"pageYOffset":"pageXOffset"]:e instanceof Document?r=e.documentElement[i]:(e instanceof HTMLElement||e)&&(r=e[i]),e&&!D(e)&&typeof r!="number"&&(r=(o=(e.ownerDocument??e).documentElement)==null?void 0:o[i]),r}function Z(e,c,o,i){const r=o-c;return e/=i/2,e<1?r/2*e*e*e+c:r/2*((e-=2)*e*e+2)+c}function ee(e,c={}){const{getContainer:o=()=>window,callback:i,duration:r=450}=c,t=o(),f=U(t,!0),y=Date.now(),g=()=>{const u=Date.now()-y,h=Z(u>r?r:u,f,e,r);D(t)?t.scrollTo(window.scrollX,h):t instanceof Document||t.constructor.name==="HTMLDocument"?t.documentElement.scrollTop=h:t.scrollTop=h,u<r?requestAnimationFrame(g):typeof i=="function"&&requestAnimationFrame(i)};requestAnimationFrame(g)}const ne={class:"anchor__children"},X=z({__name:"anchor-link",props:{anchor:{},activeKey:{}},emits:["click"],setup(e,{emit:c}){const o=(i,r)=>{c("click",i,r)};return(i,r)=>(k(),C("div",{class:"anchor__link",onClick:r[0]||(r[0]=t=>o(t,i.anchor))},[d("div",{class:K(["anchor__title",i.activeKey===i.anchor.link?"active":""])},M(i.anchor.title),3),d("div",ne,[(k(!0),C(R,null,q(i.anchor.children,t=>(k(),F(X,{key:t.link,anchor:t,"active-key":i.activeKey,onClick:f=>o(f,t)},null,8,["anchor","active-key","onClick"]))),128))])]))}}),te=z({__name:"anchor",props:{modelValue:{},container:{type:[String,Function],default:()=>window},anchors:{default:()=>[]},targetOffset:{},offsetTop:{},direction:{default:"vertical"},bounds:{default:5}},emits:["update:model-value","change"],setup(e,{emit:c}){const o=e,i=_(null),r=_(null),t=P({active:"",animating:!1,links:[]});Y(()=>{w(x());const n=p();u(),n==null||n.addEventListener("scroll",u),A([()=>o],()=>{w(x());const a=p();u(),a==null||a.addEventListener("scroll",u)},{deep:!0,flush:"post"}),A(()=>o.modelValue,(a,l)=>{console.log("modelValue",o.modelValue),!(a===l||t.active===a)&&H(()=>{o.modelValue&&f(o.modelValue)})},{immediate:!0})}),G(()=>{const n=p();n==null||n.removeEventListener("scroll",u)});const f=n=>{y(n),g(n)};function y(n){t.animating||t.active===n||(t.active=n,H(()=>{var a;const l=(a=i.value)==null?void 0:a.querySelector(".anchor__title.active");if(!l||!r.value)return;const v=l==null?void 0:l.offsetTop,m=l.clientHeight,s=r.value.style;o.direction==="horizontal"?(s.left=`${l.offsetLeft}px`,s.width=`${l.clientWidth}px`):(s.top=`${v+m/2}px`,s.height=`${m}px`),j()}))}function g(n){if(t.animating)return;const a=document.getElementById(n);if(!a)return;const l=p();if(!l)return;const v=U(l,!0),m=T(a,l);let s=v+m;s-=I(),t.animating=!0,l&&ee(s,{getContainer:()=>l,callback(){t.animating=!1}})}function u(){if(t.animating)return;const n=h(t.links,I(),o.bounds);n&&y(n)}const h=(n,a=0,l=5)=>{const v=[],m=p();return n.forEach(s=>{const b=document.getElementById(s);if(b&&m){const S=T(b,m);S<a+l&&v.push({link:s,top:S})}}),v.length?v.reduce((s,b)=>b.top>s.top?b:s).link:""};function T(n,a){if(!n.getClientRects().length)return 0;const l=n.getBoundingClientRect();return l.width||l.height?a===window?(a=document.documentElement,l.top-a.clientTop):l.top-a.getBoundingClientRect().top:l.top}function p(){let n=null;return typeof o.container=="string"?n=document.querySelector(o.container):n=o.container(),n||window}function w(n){n.forEach(a=>{t.links.push(a.link),a.children&&w(a.children)})}function x(){return o.direction==="horizontal"?o.anchors.map(n=>({...n,children:void 0})):o.anchors}function I(){const{targetOffset:n,offsetTop:a}=o;return n!==void 0?n:a||0}function j(){c("change",t.active),c("update:model-value",t.active)}return(n,a)=>(k(),C("div",{ref_key:"anchorRef",ref:i,class:K(["anchor",n.direction==="horizontal"?"is-horizontal":""])},[d("span",{ref_key:"indicatorRef",ref:r,class:"anchor-indicator"},null,512),(k(!0),C(R,null,q(x(),l=>(k(),F(X,{key:l.link,anchor:l,"active-key":t.active,onClick:a[0]||(a[0]=(v,m)=>f(m.link))},null,8,["anchor","active-key"]))),128))],2))}}),L=N(te),E=e=>(J("data-v-aa0ab75f"),e=e(),Q(),e),oe=E(()=>d("div",{id:"part-1",class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}}," part-1 ",-1)),ae=E(()=>d("div",{id:"part-4",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-4 ",-1)),re=E(()=>d("div",{id:"part-5",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-5 ",-1)),le=E(()=>d("div",{id:"part-2",class:"ac-container",style:{"background-color":"rgba(0, 255, 0, 0.02)"}}," part-2 ",-1)),ie=E(()=>d("div",{id:"part-3",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-3 ",-1)),ce=[oe,ae,re,le,ie],se=["id"],ue=z({__name:"anchor-demo",setup(e){const c=_(),o=_(),i=_("part-4"),r=_(40);setTimeout(()=>{i.value="part-3",r.value=30},1e3);const t=[{title:"part-1",link:"part-1",children:[{title:"part-4",link:"part-4"},{title:"part-5",link:"part-5"}]},{title:"part-2",link:"part-2"},{title:"part-3",link:"part-3"}],f=[{title:"part-11",link:"part-11",children:[{title:"part-12",link:"part-12"},{title:"part-13",link:"part-13"}]},{title:"part-21",link:"part-21"},{title:"part-31",link:"part-32"}],y=g=>{console.log("link anchorChangeHandler",g)};return console.log("Anchor",L),(g,u)=>{const h=O("page-card"),T=O("page-wrapper");return k(),F(T,null,{default:B(()=>[V(h,{header:"锚点",full:!1,style:{"margin-bottom":"20px"}},{default:B(()=>[V($(L),{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=p=>i.value=p),container:()=>c.value,anchors:t,bounds:r.value,onChange:y},null,8,["modelValue","container","bounds"]),d("div",{ref_key:"containerRef",ref:c,style:{height:"500px",overflow:"auto"}},ce,512)]),_:1}),V(h,{full:!1,header:"horizontal 模式<"},{default:B(()=>[V($(L),{container:()=>o.value,anchors:f,direction:"horizontal"},null,8,["container"]),d("div",{ref_key:"container2Ref",ref:o,style:{height:"500px",overflow:"auto"}},[(k(),C(R,null,q(f,(p,w)=>d("div",{id:p.link,key:w,class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}},M(p.title),9,se)),64))],512)]),_:1})]),_:1})}}}),he=W(ue,[["__scopeId","data-v-aa0ab75f"]]);export{he as default};
