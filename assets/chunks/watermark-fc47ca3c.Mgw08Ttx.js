import{u as $e,D as we}from"./index.V9EroKAY.js";import{d as te,h as T,al as ze,g as ne,j as oe,D as H,aI as _e,o as ae,b as Ie,w as g,t as Se,k as D,m as L,I as y,aD as Ae,av as De,ak as Ee,y as Ce,af as Ne,c as Re,r as Be,O as Pe,P as je}from"./framework.SCZo_iHs.js";import"../app.g2pGqmxW.js";import"./theme.Lm0SghTC.js";const M=2,K=3,A=new WeakMap;function re(a,r){let t=null;return{render:o,destroy:s};function o(){const l=d();if(!l)return;const{zIndex:k=1e3,rotate:h=-22,width:$,height:c,image:E,content:u,font:le,gap:ie=[100,100],offset:w=[0]}=(r==null?void 0:r.value)||{},{color:se="rgba(0, 0, 0, 0.15)",fontSize:C=14,fontWeight:ce="normal",fontStyle:ue="normal",fontFamily:O="sans-serif"}=le||{},[b,z]=ie,U=b/2,W=z/2,fe=(w==null?void 0:w[0])??U,de=(w==null?void 0:w[1])??W,_=document.createElement("canvas"),v=_.getContext("2d");if(!v)return;if(A.has(l)){const e=A.get(l);e&&(t=e)}else t=document.createElement("div");const f=J(),[N,V]=ye(v),R=(b+N)*f,B=(z+V)*f;_.setAttribute("width",`${R*M}px`),_.setAttribute("height",`${B*M}px`);const F=b*f/2,Q=z*f/2,X=N*f,Y=V*f,Z=(X+b*f)/2,q=(Y+z*f)/2,pe=F+R,me=Q+B,he=Z+R,xe=q+B;v.save(),ee(v,Z,q,h),ge(_,v,F,Q,X,Y,he,xe,pe,me,N),t&&A.set(l,t);function ge(e,n,i,p,x,m,I,S,P,j,ke){G(n,i,p,x,m),n.restore(),ee(n,I,S,h),G(n,P,j,x,m),ve(e.toDataURL(),ke)}function G(e,n,i,p,x){const m=J(),I=Number(C)*m;e.font=`${ue} normal ${ce} ${I}px/${x}px ${O}`,e.fillStyle=se,e.textAlign="center",e.textBaseline="top",e.translate(p/2,0);const S=Array.isArray(u)?u:[u];S==null||S.forEach((P,j)=>{e.fillText(P??"",n,i+j*(I+K*m))})}function ye(e){let n=120,i=64;if(!E&&e.measureText){e.font=`${Number(C)}px ${O}`;const p=Array.isArray(u)?u:[u],x=p.map(m=>e.measureText(m||"").width);n=Math.ceil(Math.max(...x)),i=Number(C)*p.length+(p.length-1)*K}return[$??n,c??i]}function be(){const e={zIndex:k,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let n=fe-U,i=de-W;return n>0&&(e.left=`${n}px`,e.width=`calc(100% - ${n}px)`,n=0),i>0&&(e.top=`${i}px`,e.height=`calc(100% - ${i}px)`,i=0),e.backgroundPosition=`${n}px ${i}px`,e}function ve(e,n){t&&t.setAttribute("style",Me({...be(),backgroundImage:`url('${e}')`,backgroundSize:`${(b+n)*M}px`})),t&&l&&l.append(t)}}function s(){if(t){t.remove(),t=null;const l=d();l&&A.delete(l)}}function d(){return L(a)}}function J(){return window.devicePixelRatio||1}function ee(a,r,t,o){a.translate(r,t),a.rotate(Math.PI/180*Number(o)),a.translate(-r,-t)}function Me(a){return Object.keys(a).map(r=>`${Te(r)}: ${a[r]};`).join(" ")}function Te(a){return a.replace(/([A-Z])/g,"-$1").toLowerCase()}const Le=te({__name:"watermark",props:{zIndex:{},rotate:{},width:{},height:{},image:{},content:{},font:{},style:{},gap:{},offset:{}},setup(a){const r=a,t=T(null),{render:o,destroy:s}=re(t,T(r));oe(()=>{t.value&&o()}),Ce(()=>r,()=>{s(),o()},{deep:!0}),Ne(()=>{s()});const d=ne(()=>({position:"relative"}));return(l,k)=>(ae(),Re("div",{ref_key:"watermarkContainerRef",ref:t,class:"watermark",style:Pe(d.value)},[Be(l.$slots,"default")],4))}}),Oe=$e(Le),Ue=D("div",{style:{height:"200px"}},null,-1),We={style:{position:"relative",height:"200px"}},Ye=te({__name:"watermark",setup(a){const r=[{label:"水印文字",key:"content",el:"el-input"},{label:"字体颜色",key:"color",el:"el-color-picker"},{label:"字体大小",key:"fontSize",el:"el-slider"},{label:"z-index",key:"zIndex",el:"el-slider"},{label:"旋转角度",key:"rotate",el:"el-slider",attrs:{min:-180,max:180}}],t=T(null),o=ze({content:"测试水印",fontSize:14,color:"rgba(0, 0, 0, 0.15)",zIndex:0,rotate:-22}),s=ne(()=>({content:o.content,font:{fontSize:o.fontSize,color:o.color},zIndex:o.zIndex,rotate:o.rotate})),{render:d,destroy:l}=re(t,s);oe(()=>{d()});const k=h=>{Object.keys(h).forEach($=>{const c=$;o[c]=h[c]}),l(),je(()=>{d()})};return(h,$)=>{const c=H("page-card"),E=H("page-wrapper"),u=_e("watermark");return ae(),Ie(E,null,{default:g(()=>[y(c,{style:{"margin-bottom":"20px"},full:!1,header:"自定义配置"},{default:g(()=>[D("pre",null,"          "+Se(s.value)+`
      `,1),y(L(we),{fields:r,model:o,"label-position":"top","enable-effect":"",onEffect:k},null,8,["model"])]),_:1}),y(c,{style:{"margin-bottom":"20px"},full:!1,header:"组件水印"},{default:g(()=>[y(L(Oe),De(Ae(s.value)),{default:g(()=>[Ue]),_:1},16)]),_:1}),y(c,{style:{"margin-bottom":"20px"},full:!1,header:"hook 水印"},{default:g(()=>[D("div",{ref_key:"hookWaterRef",ref:t,style:{position:"relative",height:"200px"}},null,512)]),_:1}),y(c,{style:{"margin-bottom":"20px"},full:!1,header:"vue 指令 水印"},{default:g(()=>[Ee(D("div",We,null,512),[[u,s.value]])]),_:1})]),_:1})}}});export{Ye as default};
