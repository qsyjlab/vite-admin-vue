import{e as j,M as G}from"./index.B_-AZqtN.js";import{d as z,h as _,an as J,l as Q,y as H,U as O,ah as X,o as k,c as C,m as p,F as D,G as F,b as q,n as $,E as S,w as B,J as E,p as U,t as I}from"./framework.D1sHVKzl.js";import"./theme.af-yJUCQ.js";function R(n){return n!=null&&n===n.window}function K(n,s){var c;if(typeof window>"u")return 0;const t="scrollTop";let a=0;return R(n)?a=n.pageYOffset:n instanceof Document?a=n.documentElement[t]:(n instanceof HTMLElement||n)&&(a=n[t]),n&&!R(n)&&typeof a!="number"&&(a=(c=(n.ownerDocument??n).documentElement)==null?void 0:c[t]),a}function Y(n,s,c,t){const a=c-s;return n/=t/2,n<1?a/2*n*n*n+s:a/2*((n-=2)*n*n+2)+s}function Z(n,s={}){const{getContainer:c=()=>window,callback:t,duration:a=450}=s,i=c(),r=K(i),h=Date.now(),v=()=>{const f=Date.now()-h,d=Y(f>a?a:f,r,n,a);R(i)?i.scrollTo(window.scrollX,d):i instanceof Document||i.constructor.name==="HTMLDocument"?i.documentElement.scrollTop=d:i.scrollTop=d,f<a?requestAnimationFrame(v):typeof t=="function"&&requestAnimationFrame(t)};requestAnimationFrame(v)}const P={class:"anchor__children"},N=z({__name:"anchor-link",props:{anchor:{},activeKey:{}},emits:["click"],setup(n,{emit:s}){const c=s,t=(a,i)=>{c("click",a,i)};return(a,i)=>(k(),C("div",{class:"anchor__link",onClick:i[0]||(i[0]=r=>t(r,a.anchor))},[p("div",{class:$(["anchor__title",a.activeKey===a.anchor.link?"active":""])},I(a.anchor.title),3),p("div",P,[(k(!0),C(D,null,F(a.anchor.children,r=>(k(),q(N,{key:r.link,anchor:r,"active-key":a.activeKey,onClick:h=>t(h,r)},null,8,["anchor","active-key","onClick"]))),128))])]))}}),ee=z({__name:"anchor",props:{modelValue:{},container:{type:[String,Function],default:()=>window},anchors:{default:()=>[]},targetOffset:{},offsetTop:{},direction:{default:"vertical"},bounds:{default:5}},emits:["update:model-value","change"],setup(n,{emit:s}){const c=s,t=n,a=_(null),i=_(null),r=J({active:"",animating:!1,links:[]});Q(()=>{V(x());const e=w();d(),e==null||e.addEventListener("scroll",d),H([()=>t],()=>{V(x());const o=w();d(),o==null||o.addEventListener("scroll",d)},{deep:!0,flush:"post"}),H(()=>t.modelValue,(o,l)=>{console.log("modelValue",t.modelValue),!(o===l||r.active===o)&&O(()=>{t.modelValue&&h(t.modelValue)})},{immediate:!0})}),X(()=>{const e=w();e==null||e.removeEventListener("scroll",d)});const h=e=>{v(e),f(e)};function v(e){r.animating||r.active===e||(r.active=e,O(()=>{var o;const l=(o=a.value)==null?void 0:o.querySelector(".anchor__title.active");if(!l||!i.value)return;const g=l==null?void 0:l.offsetTop,m=l.clientHeight,u=i.value.style;t.direction==="horizontal"?(u.left=`${l.offsetLeft}px`,u.width=`${l.clientWidth}px`):(u.top=`${g+m/2}px`,u.height=`${m}px`),W()}))}function f(e){if(r.animating)return;const o=document.getElementById(e);if(!o)return;const l=w();if(!l)return;const g=K(l),m=y(o,l);let u=g+m;u-=A(),r.animating=!0,l&&Z(u,{getContainer:()=>l,callback(){r.animating=!1}})}function d(){if(r.animating)return;const e=T(r.links,A(),t.bounds);e&&v(e)}const T=(e,o=0,l=5)=>{const g=[],m=w();return e.forEach(u=>{const b=document.getElementById(u);if(b&&m){const M=y(b,m);M<o+l&&g.push({link:u,top:M})}}),g.length?g.reduce((u,b)=>b.top>u.top?b:u).link:""};function y(e,o){if(!e.getClientRects().length)return 0;const l=e.getBoundingClientRect();return l.width||l.height?o===window?(o=document.documentElement,l.top-o.clientTop):l.top-o.getBoundingClientRect().top:l.top}function w(){let e=null;return typeof t.container=="string"?e=document.querySelector(t.container):e=t.container(),e||window}function V(e){e.forEach(o=>{r.links.push(o.link),o.children&&V(o.children)})}function x(){return t.direction==="horizontal"?t.anchors.map(e=>({...e,children:void 0})):t.anchors}function A(){const{targetOffset:e,offsetTop:o}=t;return e!==void 0?e:o||0}function W(){c("change",r.active),c("update:model-value",r.active)}return(e,o)=>(k(),C("div",{ref_key:"anchorRef",ref:a,class:$(["anchor",e.direction==="horizontal"?"is-horizontal":""])},[p("span",{ref_key:"indicatorRef",ref:i,class:"anchor-indicator"},null,512),(k(!0),C(D,null,F(x(),l=>(k(),q(N,{key:l.link,anchor:l,"active-key":r.active,onClick:o[0]||(o[0]=(g,m)=>h(m.link))},null,8,["anchor","active-key"]))),128))],2))}}),L=j(ee),ne=["id"],te=z({__name:"anchor-demo",setup(n){const s=_(),c=_(),t=_("part-4"),a=_(40);setTimeout(()=>{t.value="part-3",a.value=30},1e3);const i=[{title:"part-1",link:"part-1",children:[{title:"part-4",link:"part-4"},{title:"part-5",link:"part-5"}]},{title:"part-2",link:"part-2"},{title:"part-3",link:"part-3"}],r=[{title:"part-11",link:"part-11",children:[{title:"part-12",link:"part-12"},{title:"part-13",link:"part-13"}]},{title:"part-21",link:"part-21"},{title:"part-31",link:"part-32"}],h=v=>{console.log("link anchorChangeHandler",v)};return console.log("Anchor",L),(v,f)=>{const d=S("page-card"),T=S("page-wrapper");return k(),q(T,null,{default:B(()=>[E(d,{header:"锚点",full:!1,style:{"margin-bottom":"20px"}},{default:B(()=>[E(U(L),{modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=y=>t.value=y),container:()=>s.value,anchors:i,bounds:a.value,onChange:h},null,8,["modelValue","container","bounds"]),p("div",{ref_key:"containerRef",ref:s,style:{height:"500px",overflow:"auto"}},f[1]||(f[1]=[p("div",{id:"part-1",class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}}," part-1 ",-1),p("div",{id:"part-4",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-4 ",-1),p("div",{id:"part-5",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-5 ",-1),p("div",{id:"part-2",class:"ac-container",style:{"background-color":"rgba(0, 255, 0, 0.02)"}}," part-2 ",-1),p("div",{id:"part-3",class:"ac-container",style:{"background-color":"rgba(0, 0, 255, 0.02)"}}," part-3 ",-1)]),512)]),_:1}),E(d,{full:!1,header:"horizontal 模式<"},{default:B(()=>[E(U(L),{container:()=>c.value,anchors:r,direction:"horizontal"},null,8,["container"]),p("div",{ref_key:"container2Ref",ref:c,style:{height:"500px",overflow:"auto"}},[(k(),C(D,null,F(r,(y,w)=>p("div",{id:y.link,key:w,class:"ac-container",style:{"background-color":"rgba(255, 0, 0, 0.02)"}},I(y.title),9,ne)),64))],512)]),_:1})]),_:1})}}}),re=G(te,[["__scopeId","data-v-aa0ab75f"]]);export{re as default};
